<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VulnSpectra Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 850px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; margin-bottom: 25px; }

        /* Configuration Grid */
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e1e1e1; }
        .config-item h3 { margin: 0 0 10px 0; font-size: 16px; color: #555; }
        
        /* Checkboxes */
        .checkbox-group label { display: block; margin-bottom: 8px; cursor: pointer; }
        .checkbox-group input { margin-right: 10px; }

        /* File Upload */
        .file-upload { border: 2px dashed #ddd; padding: 15px; text-align: center; border-radius: 6px; cursor: pointer; transition: 0.3s; }
        .file-upload:hover { border-color: #1a73e8; background: #e8f0fe; }
        
        /* Main Input */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; outline: none; }
        button#scanBtn { padding: 12px 30px; background: #1a73e8; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* Progress & Results */
        .progress-container { height: 6px; background: #e0e0e0; margin-bottom: 20px; border-radius: 3px; overflow: hidden; display: none; }
        .progress-bar { width: 0%; height: 100%; background: #1a73e8; transition: width 0.3s; }
        
        .result-card { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; overflow: hidden; display: none; }
        .card-header { padding: 12px 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .card-body { padding: 15px; background: #fafafa; border-top: 1px solid #ddd; }
        .danger { background: #ffebee; color: #c62828; border-left: 5px solid #c62828; }
        .safe { background: #e8f5e9; color: #2e7d32; border-left: 5px solid #2e7d32; }
        ul { margin: 0; padding-left: 20px; }
        li { margin-bottom: 5px; word-break: break-all; }
    </style>
</head>
<body>

<div class="container">
    <h1>üõ°Ô∏è VulnSpectra Custom Scanner</h1>
    
    <div class="config-grid">
        <div class="config-item">
            <h3>1. Select Scans</h3>
            <div class="checkbox-group">
                <label><input type="checkbox" id="checkHeaders" checked> Security Headers</label>
                <label><input type="checkbox" id="checkPorts" checked> Open Ports</label>
                <label><input type="checkbox" id="checkSQL" checked> SQL Injection</label>
                <label><input type="checkbox" id="checkXSS" checked> XSS Vulnerabilities</label>
            </div>
        </div>
        <div class="config-item">
            <h3>2. Custom Payloads (Optional)</h3>
            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                <span id="fileName">üìÇ Click to Upload .txt File</span>
                <input type="file" id="fileInput" accept=".txt" style="display: none" onchange="handleFile(this)">
            </div>
            <small style="color: #666; display: block; margin-top: 5px;">Upload a list of payloads to use for SQL & XSS.</small>
        </div>
    </div>

    <div class="input-group">
        <input type="text" id="urlInput" placeholder="Enter target URL (e.g., http://testphp.vulnweb.com)" value="http://testphp.vulnweb.com">
        <button id="scanBtn" onclick="startScan()">Start Custom Scan</button>
    </div>

    <div id="statusText" style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #555;"></div>
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div id="resultsArea"></div>
</div>

<script>
    let customPayloads = [];

    // File Reader Logic
    function handleFile(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            document.getElementById('fileName').innerText = "üìÑ " + file.name;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Split file by new lines and remove empty lines
                customPayloads = e.target.result.split(/\r?\n/).filter(line => line.trim() !== "");
                alert(`Loaded ${customPayloads.length} custom payloads!`);
            };
            reader.readAsText(file);
        }
    }

    async function startScan() {
        const url = document.getElementById('urlInput').value;
        if(!url) return alert("Please enter a URL");

        // Reset UI
        document.getElementById('scanBtn').disabled = true;
        document.getElementById('progressContainer').style.display = 'block';
        document.getElementById('resultsArea').innerHTML = '';
        updateProgress(0, "Starting...");

        try {
            // STEP 1: Headers
            if(document.getElementById('checkHeaders').checked) {
                updateProgress(20, "Checking Headers...");
                await runStep('/api/scan/headers', url, "Security Headers", "üîí");
            }

            // STEP 2: Ports
            if(document.getElementById('checkPorts').checked) {
                updateProgress(40, "Scanning Ports...");
                await runStep('/api/scan/ports', url, "Open Ports", "üîå");
            }

            // STEP 3: SQL (Passes custom payloads)
            if(document.getElementById('checkSQL').checked) {
                updateProgress(60, "Testing SQL Injection...");
                await runStep('/api/scan/sql', url, "SQL Injection", "üíâ", customPayloads);
            }

            // STEP 4: XSS (Passes custom payloads)
            if(document.getElementById('checkXSS').checked) {
                updateProgress(80, "Testing XSS...");
                await runStep('/api/scan/xss', url, "XSS Vulnerabilities", "üíÄ", customPayloads);
            }

            updateProgress(100, "Scan Complete!");
        } catch (error) {
            console.error(error);
            alert("Error during scan.");
        }

        document.getElementById('scanBtn').disabled = false;
    }

    function updateProgress(percent, text) {
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('statusText').innerText = text;
    }

    async function runStep(endpoint, url, title, icon, payloads=[]) {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({url: url, payloads: payloads})
        });
        const data = await response.json();
        createCard(title, icon, data.results);
    }

    function createCard(title, icon, issues) {
        const container = document.getElementById('resultsArea');
        const isSafe = issues.length === 0;
        const colorClass = isSafe ? 'safe' : 'danger';
        const statusText = isSafe ? '‚úÖ Safe' : `‚ùå ${issues.length} Issues Found`;

        let listHtml = isSafe 
            ? '<p style="color:#666; font-style:italic;">No issues detected.</p>'
            : '<ul>' + issues.map(i => `<li>${i}</li>`).join('') + '</ul>';

        const html = `
            <div class="result-card ${colorClass}" style="display: block">
                <div class="card-header">
                    <span>${icon} ${title}</span>
                    <span>${statusText}</span>
                </div>
                <div class="card-body">${listHtml}</div>
            </div>`;
        container.innerHTML += html;
    }
</script>

</body>
</html>